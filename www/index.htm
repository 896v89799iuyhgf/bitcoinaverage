<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <title>BitcoinAverage</title>

    <meta name="keywords" content="bitcoin, price, average, bitcoin price, bitcoin exchange, bitcoin exchange rate, weighted average, weighted price, mean price, mean" />

    <link rel="icon" type="image/png" href="/favicon.png">

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="config.js"></script>
    <script type="text/javascript">
        var legendSlots = 20;
        var API_data = {};
        if (typeof config.apiIndexUrl == 'undefined' || config.apiIndexUrl == ''){
            alert('API URL config value empty!');
        }
        var API_all_url = config.apiIndexUrl+'/all';

    </script>
    <script type="text/javascript">
        $(function(){
            callAPI();
            setInterval(callAPI, config.refreshRate);

            for(var slotNum in config.currencyOrder){
                $('#slot'+slotNum+'-last, #slot'+slotNum+'-ask, #slot'+slotNum+'-bid').dblclick(function(event){
                    event.preventDefault();
                    $(this).selectText();
                });

                var slotLegendSelector = $('.slot'+slotNum+'-box');
                slotLegendSelector.mouseover(function(event){
                    renderLegend($(this).data('currencycode'));
                    $('#legend-block').show();
                });
                slotLegendSelector.mouseout(function(event){
                    $('#legend-block').hide();
                });

            }
        });

        function callAPI(){
            if (window.XDomainRequest) {
                var xhr = new window.XDomainRequest();
                xhr.open('GET', API_all_url, true);
                xhr.onload = function() {
	                var result = JSON.parse(xhr.responseText);
                    renderAll(result);
    	        }
                xhr.send();
            } else {
                $.getJSON(API_all_url, renderAll);
            }
        }

        function renderAll(result){
                API_data = result;
                var titleSet = false;

                for(var slotNum in config.currencyOrder){
                    var currencyCode = config.currencyOrder[slotNum];

                    renderRates(currencyCode, result[currencyCode], slotNum);

                    if (!titleSet){
                        titleSet = true;
                        document.title = '$'+result[currencyCode].averages.last+' - BitcoinAverage';
                    }
                }

                $('#legend-ignored-count').text($(result.ignored_exchanges).countObj());

                $('body').show();
        }

        function renderRates(currencyCode, currencyData, slotNum){
            $('.slot'+slotNum+'-box').data('currencycode', currencyCode);
            $('.slot'+slotNum+'-curcode').text(currencyCode);
            $('#slot'+slotNum+'-last').text(currencyData.averages.last);
            $('#slot'+slotNum+'-ask').text(currencyData.averages.ask);
            $('#slot'+slotNum+'-bid').text(currencyData.averages.bid);

            var flashingFigures = $('#slot'+slotNum+'-last, #slot'+slotNum+'-ask, #slot'+slotNum+'-bid');
            flashingFigures.css({ 'opacity' : 0.5});
            flashingFigures.animate({ 'opacity' : 1 }, 100);
        }

        function renderLegend(currencyCode){
            var exchangeArray = [];
            var currencyData = API_data[currencyCode];

            var index = 0;
            for(var exchange_name in currencyData.exchanges){
                currencyData.exchanges[exchange_name]['name'] = exchange_name;
                exchangeArray[index] = currencyData.exchanges[exchange_name];
                index++;
            }

            exchangeArray.sort(function(a, b){
                if(parseFloat(a.volume_percent) < parseFloat(b.volume_percent)){
                    return 1;
                } else {
                    return -1;
                }
            });

            $('.legend-curcode').text(currencyCode);


            for(var slotNum=0;slotNum<legendSlots;slotNum++){
                $('#legend-slot'+slotNum).toggle(false);
            }
            $('#legend-other').toggle(false);

            var otherCount = 0;
            var otherPercent = 0;
            var otherVolume = 0;
            for(var slotNum in exchangeArray){
                if(slotNum<legendSlots){
                    $('#legend-slot'+slotNum+'-name').text(exchangeArray[slotNum]['name']);
                    $('#legend-slot'+slotNum+'-volume_btc').text(exchangeArray[slotNum]['volume_btc']);
                    $('#legend-slot'+slotNum+'-volume_percent').text(exchangeArray[slotNum]['volume_percent']);
                    $('#legend-slot'+slotNum+'-rate').text(exchangeArray[slotNum]['rates']['last']);
                    $('#legend-slot'+slotNum).toggle(true);
                } else {
                    otherCount = otherCount+1;
                    otherPercent = otherPercent+exchangeArray[slotNum]['volume_percent'];
                    otherVolume = otherVolume+exchangeArray[slotNum]['volume_btc'];
                }
            }
            if(otherCount > 0){
                $('#slot'+slotNum+'-subslot-other').toggle(true);
                $('#slot'+slotNum+'-subslot-other-count').text(otherCount);
                $('#slot'+slotNum+'-subslot-other-volume_btc').text(otherVolume);
                $('#slot'+slotNum+'-subslot-other-volume_percent').text(otherPercent);
            }


        }


        jQuery.fn.selectText = function(){
            var doc = document
                , element = this[0]
                , range, selection
            ;
            if (doc.body.createTextRange) {
                range = document.body.createTextRange();
                range.moveToElementText(element);
                range.select();
            } else if (window.getSelection) {
                selection = window.getSelection();
                range = document.createRange();
                range.selectNodeContents(element);
                selection.removeAllRanges();
                selection.addRange(range);
            }
        };

        jQuery.fn.countObj = function(){
            var count = 0;
            var obj = this[0];
            for (i in obj) {
                if (obj.hasOwnProperty(i)) {
                    count++;
                }
            }
            return count;
        }

    </script>

    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
    <style type="text/css">
        body {
            background-color: #F5F5F5 ;
            position: relative;
            font-family: 'Open Sans', sans-serif;
        }

        html, body {
            height:100%;
            min-height: 100%
        }

        #header-n-content {
            width: 940px;
            min-height: 100%;
            height: auto !important;
            margin: 0 auto;
            vertical-align: middle;
        }

        #header{
            margin-top: 50px;
            font-size: 1.5em;
            color: #999;
        }
        .beta{
            color: #CCC;
            font-size: 0.8em;
            padding-left: 10px;
        }

        #content {
            position : absolute;
            top:50%;
            /*margin-top: -100px;*/
        }
        .slot0-box{
            display: inline-block;
        }

        .bid_ask{font-weight: bold;}
        .slot0-bid_ask{font-size: 1.3em; font-weight: bold;}
        .slot0-bid_ask-titles, .other_values{ color: #999; }

        .legend ul{
            list-style: none outside;
            margin: 0;
        }
        .legend-ignored{
            margin-top: 5px;
        }

        h2{font-size: 1.5em;}

        #legend-block{
            margin-top: 30px;
            border-top: 2px solid #999;
            display: none;
        }
        #ignored-block{
            margin-top: 50px;
            border-top: 2px solid #999;
        }
        #push_footer {
            height: 45px;
        }

        #footer, #push_footer {
            margin: 0 auto;
        }

        #footer {
            height: 25px;
            margin-top: -25px;
            width: 100%;
            color: #999;
        }
    </style>
</head>
<body style="display: none;  overflow-y: scroll">

<div class="container-fluid">
    <div id="header" class="navbar">
        <div class="span3">BitcoinAverage <span class="beta">beta</span></div>
        <div class="span1 pull-right"><a href="http://api.bitcoinaverage.com">API</a></div>
    </div>
</div>

<div class="container-fluid" style="margin-top: 5%">
            <div class="row-fluid">
                <div class="span12 text-center">
                    <div class="slot0-box" data-currencycode="">
                        <h1><span id="slot0-last"></span> <span class="slot0-curcode"></span></h1>
                        <span class="slot0-bid_ask">
                            <span class="slot0-bid_ask-titles">bid &nbsp;</span>
                            <span id="slot0-bid" title="bid"></span>
                            &nbsp;/&nbsp;
                            <span id="slot0-ask" title="ask"></span>
                            <span class="slot0-bid_ask-titles">&nbsp ask</span>
                        </span>
                    </div>
                </div>
            </div>
            <br>
            <div class="row-fluid other_values">
                <div class="span12 text-center">
                    <div class="span2 offset2 slot1-box" data-currencycode="">
                        <h4><span id="slot1-last"></span> <span class="slot1-curcode"></span></h4>
                        <p class="bid_ask"> <span id="slot1-bid" title="bid"></span>&nbsp;/&nbsp;<span id="slot1-ask" title="ask"></span> </p>
                    </div>
                    <div class="span2 slot2-box" data-currencycode="">
                        <h4><span id="slot2-last"></span> <span class="slot2-curcode"></span></h4>
                        <p class="bid_ask"> <span id="slot2-bid" title="bid"></span>&nbsp;/&nbsp;<span id="slot2-ask" title="ask"></span> </p>
                    </div>
                    <div class="span2 slot3-box" data-currencycode="">
                        <h4><span id="slot3-last"></span> <span class="slot3-curcode"></span></h4>
                        <p class="bid_ask"> <span id="slot3-bid" title="bid"></span>&nbsp;/&nbsp;<span id="slot3-ask" title="ask"></span> </p>
                    </div>
                    <div class="span2 slot4-box" data-currencycode="">
                        <h4><span id="slot4-last"></span> <span class="slot4-curcode"></span></h4>
                        <p class="bid_ask"> <span id="slot4-bid" title="bid"></span>&nbsp;/&nbsp;<span id="slot4-ask" title="ask"></span> </p>
                    </div>
                    <!--<div class="span2 slot5-box" data-currencycode="">-->
                        <!--<h4><span id="slot5-last"></span> <span class="slot5-curcode"></span></h4>-->
                        <!--<p class="bid_ask"> <span id="slot5-bid" title="bid"></span>&nbsp;/&nbsp;<span id="slot5-ask" title="ask"></span> </p>-->
                    <!--</div>-->
                </div>
            </div>
            <div class="row-fluid">
                <div class="span6 offset3" id="legend-block">
                    <div class="">
                        <h2>Data for <span class="legend-curcode"></span> weighted average price picked from</h2>
                    </div>
                    <table class="table table-striped table-condensed">
                            <tr id="legend-slot0">
                                    <td class="span1 legend-name"><span id="legend-slot0-name"></span></td>
                                    <td class="span1 legend-volume_percent"><span id="legend-slot0-volume_percent"></span>%</td>
                                    <td class="span2 legend-volume_btc">(&#3647; <span id="legend-slot0-volume_btc"></span>)</td>
                                    <td class="span2 legend-rate">at rate <span id="legend-slot0-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot1">
                                    <td class="span1 legend-name"><span id="legend-slot1-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot1-volume_percent"></span>%</td>
                                    <td class="span2 legend-volume_btc">(&#3647; <span id="legend-slot1-volume_btc"></span>)</td>
                                    <td class="span2 legend-rate text-right">at rate <span id="legend-slot1-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot2">
                                    <td class="span1 legend-name"><span id="legend-slot2-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot2-volume_percent"></span>%</td>
                                    <td class="span2 legend-volume_btc">(&#3647; <span id="legend-slot2-volume_btc"></span>)</td>
                                    <td class="span2 legend-rate text-right">at rate <span id="legend-slot2-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot3">
                                    <td class="span1 legend-name"><span id="legend-slot3-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot3-volume_percent"></span>%</td>
                                    <td class="span2 legend-volume_btc">(&#3647; <span id="legend-slot3-volume_btc"></span>)</td>
                                    <td class="span2 legend-rate text-right">at rate <span id="legend-slot3-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot4">
                                    <td class="span1 legend-name"><span id="legend-slot4-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot4-volume_percent"></span>%</td>
                                    <td class="span3 legend-volume_btc">(&#3647; <span id="legend-slot4-volume_btc"></span>)</td>
                                    <td class="span3 legend-rate text-right">at rate <span id="legend-slot4-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot5">
                                    <td class="span1 legend-name"><span id="legend-slot5-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot5-volume_percent"></span>%</td>
                                    <td class="span3 legend-volume_btc">(&#3647; <span id="legend-slot5-volume_btc"></span>)</td>
                                    <td class="span3 legend-rate text-right">at rate <span id="legend-slot5-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot6">
                                    <td class="span1 legend-name"><span id="legend-slot6-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot6-volume_percent"></span>%</td>
                                    <td class="span3 legend-volume_btc">(&#3647; <span id="legend-slot6-volume_btc"></span>)</td>
                                    <td class="span3 legend-rate text-right">at rate <span id="legend-slot6-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot7">
                                    <td class="span1 legend-name"><span id="legend-slot7-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot7-volume_percent"></span>%</td>
                                    <td class="span3 legend-volume_btc">(&#3647; <span id="legend-slot7-volume_btc"></span>)</td>
                                    <td class="span3 legend-rate text-right">at rate <span id="legend-slot7-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot8">
                                    <td class="span1 legend-name"><span id="legend-slot8-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot8-volume_percent"></span>%</td>
                                    <td class="span3 legend-volume_btc">(&#3647; <span id="legend-slot8-volume_btc"></span>)</td>
                                    <td class="span3 legend-rate">at rate <span id="legend-slot8-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot9">
                                    <td class="span1 legend-name"><span id="legend-slot9-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot9-volume_percent"></span>%</td>
                                    <td class="span3 legend-volume_btc">(&#3647; <span id="legend-slot9-volume_btc"></span>)</td>
                                    <td class="span3 legend-rate">at rate <span id="legend-slot9-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot10">
                                    <td class="span1 legend-name"><span id="legend-slot10-name"></span></td>
                                    <td class="span1 legend-volume_percent"><span id="legend-slot10-volume_percent"></span>%</td>
                                    <td class="span2 legend-volume_btc">(&#3647; <span id="legend-slot10-volume_btc"></span>)</td>
                                    <td class="span2 legend-rate">at rate <span id="legend-slot10-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot11">
                                    <td class="span1 legend-name"><span id="legend-slot11-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot11-volume_percent"></span>%</td>
                                    <td class="span2 legend-volume_btc">(&#3647; <span id="legend-slot11-volume_btc"></span>)</td>
                                    <td class="span2 legend-rate text-right">at rate <span id="legend-slot11-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot12">
                                    <td class="span1 legend-name"><span id="legend-slot12-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot12-volume_percent"></span>%</td>
                                    <td class="span2 legend-volume_btc">(&#3647; <span id="legend-slot12-volume_btc"></span>)</td>
                                    <td class="span2 legend-rate text-right">at rate <span id="legend-slot12-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot13">
                                    <td class="span1 legend-name"><span id="legend-slot13-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot13-volume_percent"></span>%</td>
                                    <td class="span2 legend-volume_btc">(&#3647; <span id="legend-slot13-volume_btc"></span>)</td>
                                    <td class="span2 legend-rate text-right">at rate <span id="legend-slot13-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot14">
                                    <td class="span1 legend-name"><span id="legend-slot14-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot14-volume_percent"></span>%</td>
                                    <td class="span3 legend-volume_btc">(&#3647; <span id="legend-slot14-volume_btc"></span>)</td>
                                    <td class="span3 legend-rate text-right">at rate <span id="legend-slot14-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot15">
                                    <td class="span1 legend-name"><span id="legend-slot15-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot15-volume_percent"></span>%</td>
                                    <td class="span3 legend-volume_btc">(&#3647; <span id="legend-slot15-volume_btc"></span>)</td>
                                    <td class="span3 legend-rate text-right">at rate <span id="legend-slot15-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot16">
                                    <td class="span1 legend-name"><span id="legend-slot16-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot16-volume_percent"></span>%</td>
                                    <td class="span3 legend-volume_btc">(&#3647; <span id="legend-slot16-volume_btc"></span>)</td>
                                    <td class="span3 legend-rate text-right">at rate <span id="legend-slot16-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot17">
                                    <td class="span1 legend-name"><span id="legend-slot17-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot17-volume_percent"></span>%</td>
                                    <td class="span3 legend-volume_btc">(&#3647; <span id="legend-slot17-volume_btc"></span>)</td>
                                    <td class="span3 legend-rate text-right">at rate <span id="legend-slot17-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot18">
                                    <td class="span1 legend-name"><span id="legend-slot18-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot18-volume_percent"></span>%</td>
                                    <td class="span3 legend-volume_btc">(&#3647; <span id="legend-slot18-volume_btc"></span>)</td>
                                    <td class="span3 legend-rate text-right">at rate <span id="legend-slot18-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <tr id="legend-slot19">
                                    <td class="span1 legend-name"><span id="legend-slot19-name"></span></td>
                                    <td class="span1 legend-volume_percent text-right"><span id="legend-slot19-volume_percent"></span>%</td>
                                    <td class="span3 legend-volume_btc">(&#3647; <span id="legend-slot19-volume_btc"></span>)</td>
                                    <td class="span3 legend-rate text-right">at rate <span id="legend-slot19-rate"></span> <span class="legend-curcode"></span></td>
                            </tr>
                            <!--<li>-->
                                <!--<div class="span4 offset2 legend-ignored">-->
                                    <!--<span id="legend-ignored-count"></span> ignored (no API or trading volume data)-->
                                <!--</div>-->
                            <!--</li>-->
                    </table>
                </div>
            </div>
            <!--<div class="row-fluid">-->
                <!--<div class="span6 offset3" id="ignored-block">-->
                    <!--<div class="">-->
                        <!--<h2>Ignored List</h2>-->
                    <!--</div>-->
                    <!--<table class="table table-striped">-->
                            <!--<tr>-->
                                <!--<div class="span4 legend-ignored">-->
                                    <!--<span id="legend-ignored-count"></span> ignored (no API or trading volume data)-->
                                <!--</div>-->
                            <!--</td>-->
                    <!--</table>-->
                <!--</div>-->
            <!--</div>-->

    <div id="push_footer"></div>
</div>


<!--<div id="footer">-->
    <!--<footer class="footer">-->
        <!--<div class="text-center">-->
            <!--relative USD volumes:-->
            <!--MTGox <span id="mtgox-weight"></span>,-->
            <!--bitstamp <span id="bitstamp-weight"></span>,-->
            <!--btce <span id="bitstamp-weight"></span>,-->
            <!--bitstamp <span id="bitstamp-weight"></span>-->
        <!--</div>-->
    <!--</footer>-->
<!--</div>-->


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-42688472-1', 'bitcoinaverage.com');
ga('send', 'pageview');

</script>
</body>
</html>
